<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>منشور هم‌سرنوشتی</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
  <style>
    body { font-family: "Tahoma", sans-serif; direction: rtl; }
    
    /* تنظیمات سایدبار راست‌چین استاندارد */
    .sidebar { left: auto !important; right: 0 !important; border-left: 1px solid rgba(0,0,0,.07); border-right: none !important; }
    .content { left: 0 !important; right: 300px !important; }
    .sidebar-toggle { left: auto !important; right: 0 !important; }

    /* هماهنگی با دکمه بستن منو */
    body.close .sidebar { transform: translateX(300px); }
    body.close .content { right: 0 !important; }

    .markdown-section { text-align: right; direction: rtl; padding: 20px 45px; }

    /* اجبار به بولد شدن لینک‌های اصلی سایدبار */
.sidebar-nav > ul > li > a, 
.sidebar-nav > ul > li > strong > a {
  font-weight: bold !important;
  font-size: 15px !important;
  color: #333 !important; /* رنگ تیره برای وضوح بیشتر */
}

/* نرمال نگه داشتن زیرمجموعه‌ها */
.sidebar-nav > ul > li ul li a {
  font-weight: normal !important;
  font-size: 14px !important;
}

/* بولد کردن تیترهای بدون لینک (اگر وجود داشته باشند) */
.sidebar-nav p strong, 
.sidebar-nav li strong {
  display: block;
  margin-top: 10px;
  font-weight: 800 !important;
}
    
    @media screen and (max-width: 768px) {
      .content { right: 0 !important; }
      .sidebar { transform: translateX(300px); }
      body.close .sidebar { transform: translateX(0) !important; }
    }
  </style>
</head>
<body>
  <div id="app">در حال بارگذاری...</div>
<script>
 window.$docsify = {
    name: 'منشور هم‌سرنوشتی',
    repo: 'https://github.com/CharterOfIran/Transition-Protocol',
    loadSidebar: true,
    subMaxLevel: 3,
    auto2top: true,
    rtl: true,
    
    // غیرفعال کردن مسیر نسبی برای جلوگیری از تکرار نام پوشه‌ها در سایدبار
    relativePath: false,

plugins: [
      function(hook, vm) {
        hook.beforeEach(function(html) {
          // ۱. گرفتن مسیر فعلی بدون نام فایل (فقط پوشه)
          // مثال: اگر در /Infrastructure/Mesh-Networks هستیم، خروجی می‌شود /Infrastructure/
          const currentPath = location.hash.replace('#', '');
          const currentDir = currentPath.substring(0, currentPath.lastIndexOf('/') + 1) || '/';

          // ۲. شناسایی لینک‌های داخلی (.md) که مطلق نیستند
          return html.replace(/\[([^\]]+)\]\((?!http|https|\/)([^)]+)\.md\)/g, function(match, text, path) {
            
            // ۳. پاکسازی مسیر لینک
            let targetPath = path.replace(/^\.\//, ''); // حذف ./ ابتدایی
            
            let finalLink;
            if (targetPath.startsWith('../')) {
              // اگر لینک به عقب برمی‌گردد، از مکانیزم داخلی مرورگر برای حل آدرس استفاده می‌کنیم
              // این کار آدرس‌های زشت را پاکسازی می‌کند
              const dummyBase = "http://x.com" + currentDir;
              const resolved = new URL(targetPath + '.md', dummyBase);
              finalLink = resolved.pathname;
            } else {
              // اگر لینک در همان پوشه است، مستقیم به دایرکتوری فعلی می‌چسبانیم
              finalLink = currentDir + targetPath + '.md';
            }

            // ۴. اطمینان از حذف اسلش‌های تکراری
            finalLink = finalLink.replace(/\/+/g, '/');

            return '[' + text + '](' + finalLink + ')';
          });
        });
      }
    ]
  };
</script>
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
</body>
</html>
